{"version":3,"sources":["webpack:///./sarsa/core/utils.ts","webpack:///./sarsa/core/sprites.ts","webpack:///./sarsa/heatmap.tsx","webpack:///./sarsa/core/const.ts","webpack:///./sarsa/core/policies.ts","webpack:///./sarsa/core/agent.ts","webpack:///./sarsa/control.tsx","webpack:///./sarsa/arena.tsx","webpack:///./sarsa/core/map.ts"],"names":["sleep","ms","Promise","resolve","setTimeout","sprites","ground","Image","borderTop","borderLeft","borderRight","borderLeftUp","borderRightUp","borderBottom","borderBottom2","borderBottomLeft","borderBottomLeft2","borderBottomRight","borderBottomRight2","goomba","goomba2","goomba3","marioFace","marioFace1","marioFace2","marioLeft","marioLeft1","marioLeft2","marioRight","marioRight1","marioRight2","marioBack","marioBack1","marioBack2","block","redBlock","blockShadow","src","loaded","res","img","complete","color1","color2","getColor","q","percent","Math","min","max","exp","floor","HeatMap","props","canvas","useRef","draw","ctx","Q","w","h","strokeStyle","lineWidth","i","j","fillStyle","fillRect","blockSize","strokeRect","UP","beginPath","moveTo","lineTo","fill","RIGHT","BOTTOM","LEFT","drawQValues","agent","map","current","getContext","translate","gradient","createLinearGradient","addColorStop","font","textAlign","fillText","drawScale","useEffect","width","height","ref","greedy","Infinity","maxIdx","length","push","random","Agent","initialX","initialY","this","lastActions","lastGreedyAction","initialPositionX","initialPositionY","x","y","lastX","lastY","initQ","Qrow","Array","newRun","a","shift","n","nSteps","reinforce","lastRewards","chooseAction","softmax","beta","total","r","cumsum","epsilon","epsilonGreedy","unshift","deltaQ","discount","gamma","learningRate","QLearning","pop","getReward","newPosition","getSprite","t","console","log","dx","dy","drawImage","Radio","RadioTMP","RadioGroup","RadioGroupTMP","FormControlLabel","FormControlLabelTMP","Slider","SliderTMP","Tooltip","TooltipTMP","useStyles","makeStyles","theme","createStyles","slider","spacing","margin","ValueLabelComponent","open","enterTouchDelay","placement","title","value","children","DiscountFactorPicker","useState","discountFactor","setdiscountFactor","classes","gutterBottom","step","onChange","event","newValue","className","LearningRatePicker","setLearningRate","StepsPicker","steps","setSteps","marks","LearningStrategy","setQLearning","aria-label","name","control","label","Policy","setSoftmax","setEpsilon","setBeta","Activate","run","setRun","refreshRate","setRefreshRate","playTooltip","newRate","speedup","onClick","fontSize","updateRefreshRate","restart","Arena","delay","initSarsa","Map","turn","agents","MapRow","addAgent","addElement","e","initialRendering","elt","undefined","drawAgent","action","newX","newY","reward","Element","Reward","SmallReward","Monster"],"mappings":"6FAAO,SAASA,EAAMC,GAClB,OAAO,IAAIC,SAAQ,SAAAC,GAAO,OAAIC,WAAWD,EAASF,MADtD,mC,kCCAA,sCAAMI,EAA0C,CAC5CC,OAAQ,IAAIC,MACZC,UAAW,IAAID,MACfE,WAAY,IAAIF,MAChBG,YAAa,IAAIH,MACjBI,aAAc,IAAIJ,MAClBK,cAAe,IAAIL,MACnBM,aAAc,IAAIN,MAClBO,cAAe,IAAIP,MACnBQ,iBAAkB,IAAIR,MACtBS,kBAAmB,IAAIT,MACvBU,kBAAmB,IAAIV,MACvBW,mBAAoB,IAAIX,MAExBY,OAAQ,IAAIZ,MACZa,QAAS,IAAIb,MACbc,QAAS,IAAId,MAEbe,UAAW,IAAIf,MACfgB,WAAY,IAAIhB,MAChBiB,WAAY,IAAIjB,MAChBkB,UAAW,IAAIlB,MACfmB,WAAY,IAAInB,MAChBoB,WAAY,IAAIpB,MAChBqB,WAAY,IAAIrB,MAChBsB,YAAa,IAAItB,MACjBuB,YAAa,IAAIvB,MACjBwB,UAAW,IAAIxB,MACfyB,WAAY,IAAIzB,MAChB0B,WAAY,IAAI1B,MAEhB2B,MAAO,IAAI3B,MACX4B,SAAU,IAAI5B,MACd6B,YAAa,IAAI7B,OAGrBF,EAAQC,OAAO+B,IAAM,oBACrBhC,EAAQG,UAAU6B,IAAM,wBACxBhC,EAAQI,WAAW4B,IAAM,yBACzBhC,EAAQK,YAAY2B,IAAM,0BAC1BhC,EAAQM,aAAa0B,IAAM,4BAC3BhC,EAAQO,cAAcyB,IAAM,6BAC5BhC,EAAQQ,aAAawB,IAAM,2BAC3BhC,EAAQS,cAAcuB,IAAM,4BAC5BhC,EAAQU,iBAAiBsB,IAAM,gCAC/BhC,EAAQW,kBAAkBqB,IAAM,iCAChChC,EAAQY,kBAAkBoB,IAAM,iCAChChC,EAAQa,mBAAmBmB,IAAM,kCAEjChC,EAAQc,OAAOkB,IAAM,oBACrBhC,EAAQe,QAAQiB,IAAM,qBACtBhC,EAAQgB,QAAQgB,IAAM,qBAEtBhC,EAAQiB,UAAUe,IAAM,yBACxBhC,EAAQkB,WAAWc,IAAM,0BACzBhC,EAAQmB,WAAWa,IAAM,0BACzBhC,EAAQ0B,UAAUM,IAAM,wBACxBhC,EAAQ2B,WAAWK,IAAM,yBACzBhC,EAAQ4B,WAAWI,IAAM,yBACzBhC,EAAQuB,WAAWS,IAAM,yBACzBhC,EAAQwB,YAAYQ,IAAM,0BAC1BhC,EAAQyB,YAAYO,IAAM,0BAC1BhC,EAAQoB,UAAUY,IAAM,wBACxBhC,EAAQqB,WAAWW,IAAM,yBACzBhC,EAAQsB,WAAWU,IAAM,yBAEzBhC,EAAQ6B,MAAMG,IAAM,mBACpBhC,EAAQ8B,SAASE,IAAM,uBACvBhC,EAAQ+B,YAAYC,IAAM,0BAEnB,IAAMC,EAAS,WAClB,IAAIC,GAAM,EACV,IAAK,IAAIC,KAAOnC,EACZkC,EAAMA,GAAOlC,EAAQmC,GAAKC,SAE9B,OAAOF,GAGIlC,O,mCC7Ef,sFAMMqC,EAAS,CAAC,IAAK,EAAG,KAClBC,EAAS,CAAC,EAAG,IAAK,KAElBC,EAAW,SAACC,GACd,IAAMC,EAAUC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG,GAAK,EAAIF,KAAKG,KAAK,EAAIL,MAC/D,uBACME,KAAKI,MAAMR,EAAO,IAAMD,EAAO,GAAKC,EAAO,IAAMG,GADvD,cAEMC,KAAKI,MAAMR,EAAO,IAAMD,EAAO,GAAKC,EAAO,IAAMG,GAFvD,cAGMC,KAAKI,MAAMR,EAAO,IAAMD,EAAO,GAAKC,EAAO,IAAMG,GAHvD,KAyESM,EAAU,SAACC,GACpB,IAAMC,EAASC,YAAiC,MAE1CC,EAAO,0DAWL,OA3DQ,SAChBC,EACAC,EACAC,EACAC,GAEAH,EAAII,YAAc,UAClBJ,EAAIK,UAAY,EAChB,IAAK,IAAIC,EAAI,EAAGA,EAAIJ,EAAGI,IACnB,IAAK,IAAIC,EAAI,EAAGA,EAAIJ,EAAGI,IACnBP,EAAIQ,UAAYrB,EAAS,GACzBa,EAAIS,SAASH,EAAII,IAAWH,EAAIG,IAAWA,IAAWA,KACtDV,EAAIW,WAAWL,EAAII,IAAWH,EAAIG,IAAWA,IAAWA,KAExDV,EAAIQ,UAAYrB,EAASc,EAAEK,GAAGC,GAAGK,MACjCZ,EAAIa,YACJb,EAAIc,QAAQR,EAAI,IAAOI,KAAYH,EAAI,IAAOG,KAC9CV,EAAIe,QAAQT,EAAI,GAAKI,IAAWH,EAAIG,KACpCV,EAAIe,OAAOT,EAAII,IAAWH,EAAIG,KAC9BV,EAAIgB,OAEJhB,EAAIQ,UAAYrB,EAASc,EAAEK,GAAGC,GAAGU,MACjCjB,EAAIa,YACJb,EAAIc,QAAQR,EAAI,IAAOI,KAAYH,EAAI,IAAOG,KAC9CV,EAAIe,QAAQT,EAAI,GAAKI,IAAWH,EAAIG,KACpCV,EAAIe,QAAQT,EAAI,GAAKI,KAAYH,EAAI,GAAKG,KAC1CV,EAAIgB,OAEJhB,EAAIQ,UAAYrB,EAASc,EAAEK,GAAGC,GAAGW,MACjClB,EAAIa,YACJb,EAAIc,QAAQR,EAAI,IAAOI,KAAYH,EAAI,IAAOG,KAC9CV,EAAIe,QAAQT,EAAI,GAAKI,KAAYH,EAAI,GAAKG,KAC1CV,EAAIe,OAAOT,EAAII,KAAYH,EAAI,GAAKG,KACpCV,EAAIgB,OAEJhB,EAAIQ,UAAYrB,EAASc,EAAEK,GAAGC,GAAGY,MACjCnB,EAAIa,YACJb,EAAIc,QAAQR,EAAI,IAAOI,KAAYH,EAAI,IAAOG,KAC9CV,EAAIe,OAAOT,EAAII,KAAYH,EAAI,GAAKG,KACpCV,EAAIe,OAAOT,EAAII,IAAWH,EAAIG,KAC9BV,EAAIgB,OAkBJI,CAAYpB,EAAKJ,EAAMyB,MAAMpB,EAAGL,EAAM0B,IAAIpB,EAAGN,EAAM0B,IAAInB,GACvD,gBAAM5D,YAAM,MAAZ,MAAgB,mDAXX,4BAGHyD,EAHG,EACT,OAAsB,MAAlBH,EAAO0B,SAGA,OADLvB,EAAMH,EAAO0B,QAAQC,WAAW,OAFV,KAK5BxB,EAAIyB,UAAUf,IAAWA,KA5Ef,SAACV,EAA+BE,EAAWC,GACzDH,EAAII,YAAc,UAClB,IAAMsB,EAAW1B,EAAI2B,qBACjB,GACC,GAAMxB,GAAKO,IACZR,EAAIQ,KACH,GAAMP,GAAKO,KAEhBgB,EAASE,aAAa,EAAtB,OAAgC3C,EAAO,GAAvC,IAA6CA,EAAO,GAApD,IAA0DA,EAAO,GAAjE,KACAyC,EAASE,aAAa,EAAtB,OAAgC1C,EAAO,GAAvC,IAA6CA,EAAO,GAApD,IAA0DA,EAAO,GAAjE,KACAc,EAAIQ,UAAYkB,EAChB1B,EAAIW,WAAW,GAAI,GAAMR,GAAKO,IAAWR,EAAIQ,IAAW,GAAMA,KAC9DV,EAAIS,SAAS,GAAI,GAAMN,GAAKO,IAAWR,EAAIQ,IAAW,GAAMA,KAE5DV,EAAI6B,KAAO,kBACX7B,EAAI8B,UAAY,SAChB9B,EAAIQ,UAAY,UAChBR,EAAI+B,SAAS,IAAM7B,EAAIQ,IAAa,GAAI,IAAMP,GAAKO,KACnDV,EAAI+B,SAAS,KAAM7B,EAAIQ,KAAY,IAAMP,GAAKO,KAC9CV,EAAI+B,SAAS,KAAM,GAAI,IAAM5B,GAAKO,KA2D9BsB,CAAUhC,EAAKJ,EAAM0B,IAAIpB,EAAGN,EAAM0B,IAAInB,IAR7B,qLAmBb,OAJA8B,aAAU,WACNlC,OAIA,YACImC,OAAQ,EAAItC,EAAM0B,IAAIpB,GAAKQ,IAC3ByB,QAAS,EAAIvC,EAAM0B,IAAInB,GAAKO,IAC5B0B,IAAKvC,O,4DC/GjB,0KAAO,IAAMe,EAAK,EACLK,EAAQ,EACRC,EAAS,EACTC,EAAO,EAEPT,EAAY,I,wNCLZ2B,EAAS,SAACpC,GAGnB,IAFA,IAAIT,GAAO8C,IACPC,EAAmB,GACdjC,EAAI,EAAGA,EAAIL,EAAEuC,OAAQlC,IACtBL,EAAEK,GAAKd,GACP+C,EAAS,CAACjC,GACVd,EAAMS,EAAEK,IACDL,EAAEK,IAAMd,GACf+C,EAAOE,KAAKnC,GAIpB,OAAqB,GAAjBiC,EAAOC,OAAoBD,EAAO,GAC/BA,EAAOjD,KAAKI,MAAMJ,KAAKoD,SAAWH,EAAOC,UCP/BG,E,WAmBjB,WACIR,EACAD,EACAU,EACAC,GACF,WAvBgB,CAAC,CAAC,MAuBlB,sBAtBa,IAsBb,eArBM,IAqBN,iBApBQ,IAoBR,cAnBK,GAmBL,kBAlBQ,GAkBR,oBAjBU,GAiBV,gBAhBO,GAgBP,yGAXsB,IAWtB,qBAVsB,IAUtB,4DARiB,GAQjB,0BAPiB,GAQfC,KAAKC,YAAc,CAAC7B,KACpB4B,KAAKE,iBAAmB9B,IACxB4B,KAAKG,iBAAmBL,GAAY,EACpCE,KAAKI,iBAAmBL,GAAY,EACpCC,KAAKK,EAAIL,KAAKG,iBACdH,KAAKM,EAAIN,KAAKI,iBACdJ,KAAKO,MAAQ,CAACP,KAAKG,kBACnBH,KAAKQ,MAAQ,CAACR,KAAKI,kBACnBJ,KAAKS,MAAMpB,EAAQD,G,2BAGvBqB,MAAA,SAAMpB,EAAgBD,GAClBY,KAAK7C,EAAI,GACT,IAAK,IAAIK,EAAI,EAAGA,EAAI4B,EAAO5B,IAAK,CAE5B,IADA,IAAMkD,EAAmB,GAChBjD,EAAI,EAAGA,EAAI4B,EAAQ5B,IACxBiD,EAAKf,KAAK,IAAIgB,MA3CZ,GA2C6BzC,KAAK,IAExC8B,KAAK7C,EAAEwC,KAAKe,K,EAIpBE,OAAA,WAEI,IAFK,MACCC,GAAI,SAAAb,KAAKC,kBAAL,IAAkBa,UAAW1C,IAC9B2C,EAAIf,KAAKgB,OAAQD,EAAI,EAAGA,IAC7Bf,KAAKiB,UAAUF,EAAGF,GAGtBb,KAAKK,EAAIL,KAAKG,iBACdH,KAAKM,EAAIN,KAAKI,iBACdJ,KAAKO,MAAQ,CAACP,KAAKG,kBACnBH,KAAKQ,MAAQ,CAACR,KAAKI,kBACnBJ,KAAKkB,YAAc,GACnBlB,KAAKC,YAAc,CAAC7B,M,EAGxB+C,aAAA,WACI,IACIN,EADE1D,EAAI6C,KAAK7C,EAAE6C,KAAKK,GAAGL,KAAKM,GAS9B,OANIO,EADAb,KAAKoB,QD/CM,SAACC,EAAclE,GAElC,IADA,IAAImE,EAAQ,EACH9D,EAAI,EAAGA,EAAI,EAAGA,IACnB8D,GAAS9E,KAAKG,IAAI0E,EAAOlE,EAAEK,IAK/B,IAFA,IAAM+D,EAAI/E,KAAKoD,SACX4B,EAAS,EACJhE,EAAI,EAAGA,EAAI,EAAGA,IAEnB,IADAgE,GAAUhF,KAAKG,IAAI0E,EAAOlE,EAAEK,IAAM8D,IACpBC,EACV,OAAO/D,EAGf,OAAO,ECkCK4D,CAAQpB,KAAKqB,KAAMlE,GDvDN,SAACsE,EAAiBtE,GAC3C,OAAIX,KAAKoD,SAAW6B,EACTjF,KAAKI,MAAMJ,KAAKoD,SAAWzC,EAAEuC,QAEjCH,EAAOpC,GCoDCuE,CAAc1B,KAAKyB,QAAStE,GACvC6C,KAAKE,iBAAmBX,EAAOpC,GAE/B6C,KAAKiB,UAAUjB,KAAKgB,OAAQH,GAC5Bb,KAAKC,YAAY0B,QAAQd,GAClBA,G,EAGXI,UAAA,SAAUF,EAAWF,GACjB,KAAIb,KAAKkB,YAAYxB,OAASqB,GAA9B,CAOA,IAJA,IAAIa,GAAU5B,KAAK7C,EAAE6C,KAAKO,MAAMQ,EAAI,IAAIf,KAAKQ,MAAMO,EAAI,IACnDf,KAAKC,YAAYc,EAAI,IAErBc,EAAW,EACNrE,EAAIuD,EAAI,EAAGvD,GAAK,EAAGA,IACxBoE,GAAU5B,KAAKkB,YAAY1D,GAAKqE,EAChCA,GAAY7B,KAAK8B,MASrB9B,KAAK7C,EAAE6C,KAAKO,MAAMQ,EAAI,IAAIf,KAAKQ,MAAMO,EAAI,IAAIf,KAAKC,YAAYc,EAAI,KAC9Df,KAAK+B,cANLH,GADA5B,KAAKgC,UACKH,EAAW7B,KAAK7C,EAAE6C,KAAKK,GAAGL,KAAKM,GAAGN,KAAKE,kBAEvC2B,EAAW7B,KAAK7C,EAAE6C,KAAKK,GAAGL,KAAKM,GAAGO,IAOhDb,KAAKC,YAAYgC,MACjBjC,KAAKkB,YAAYe,MACjBjC,KAAKO,MAAM0B,MACXjC,KAAKQ,MAAMyB,Q,EAGfC,UAAA,SAAUX,GACNvB,KAAKkB,YAAYS,QAAQJ,I,EAG7BY,YAAA,SAAY9B,EAAWC,GACnBN,KAAKO,MAAMoB,QAAQ3B,KAAKK,GACxBL,KAAKQ,MAAMmB,QAAQ3B,KAAKM,GACxBN,KAAKK,EAAIA,EACTL,KAAKM,EAAIA,G,EAGb8B,UAAA,SAAUC,GACN,OAAQrC,KAAKC,YAAY,IACrB,KAAKnC,IACD,OAAQuE,EAAI,GACR,KAAK,EACD,OAAOvI,IAAQ0B,UACnB,KAAK,EACD,OAAO1B,IAAQ2B,WACnB,KAAK,EACD,OAAO3B,IAAQ0B,UACnB,KAAK,EACD,OAAO1B,IAAQ4B,WAE3B,KAAKyC,IACD,OAAQkE,EAAI,GACR,KAAK,EACD,OAAOvI,IAAQuB,WACnB,KAAK,EACD,OAAOvB,IAAQwB,YACnB,KAAK,EACD,OAAOxB,IAAQuB,WACnB,KAAK,EACD,OAAOvB,IAAQyB,YAE3B,KAAK6C,IACD,OAAQiE,EAAI,GACR,KAAK,EACD,OAAOvI,IAAQiB,UACnB,KAAK,EACD,OAAOjB,IAAQkB,WACnB,KAAK,EACD,OAAOlB,IAAQiB,UACnB,KAAK,EACD,OAAOjB,IAAQmB,WAE3B,KAAKoD,IACD,OAAQgE,EAAI,GACR,KAAK,EACD,OAAOvI,IAAQoB,UACnB,KAAK,EACD,OAAOpB,IAAQqB,WACnB,KAAK,EACD,OAAOrB,IAAQoB,UACnB,KAAK,EACD,OAAOpB,IAAQsB,WAE3B,QAII,OAHAkH,QAAQC,IACJ,mCAAqCvC,KAAKC,aAEvCnG,IAAQiB,Y,EAI3BkC,KAAA,SAAKC,EAA+BmF,GAChC,IAAMG,GAAOxC,KAAKK,EAAIL,KAAKO,MAAM,KAAQ8B,EAAI,EAAK,GAAM,EAClDI,GAAOzC,KAAKM,EAAIN,KAAKQ,MAAM,KAAQ6B,EAAI,EAAK,GAAM,EAExDnF,EAAIwF,UACA1C,KAAKoC,UAAUC,GACfzE,KAAaoC,KAAKO,MAAM,GAAKiC,GAC7B5E,KAAaoC,KAAKQ,MAAM,GAAKiC,GAAM7E,IAAY,I,yCCpL3D,waAiBM+E,EAAaC,IACbC,EAAkBC,IAClBC,EAAwBC,IACxBC,EAAcC,IACdC,EAAeC,IAEfC,EAAYC,aAAW,SAACC,GAAD,OACzBC,YAAa,CACTC,OAAQ,CACJrE,MAAO,IAAyB,EAAnBmE,EAAMG,QAAQ,IAE/BC,OAAQ,CACJtE,OAAQkE,EAAMG,QAAQ,SAY5BE,EAA2B,SAAC9G,GAG9B,OACI,EAACqG,EAAD,CAASU,KAHqB/G,EAAhB+G,KAGOC,gBAAiB,EAAGC,UAAU,MAAMC,MAH3BlH,EAAVmH,OAAUnH,EAA1BoH,WASCC,EAAuB,SAACrH,GAA4B,MACjBsH,YAAStH,EAAMyB,MAAMuD,OAA1DuC,EADsD,KACtCC,EADsC,KAEvDC,EAAUlB,IAUhB,OACI,aACI,EAAC,IAAD,CAAYmB,cAAY,GAAxB,mBACA,EAACvB,EAAD,CACIxG,IAAK,EACLC,IAAK,EACL+H,KAAM,IACNb,oBAAqBA,EACrBK,MAAOI,EACPK,SAjBS,SAACC,EAAYC,GACN,iBAAbA,IACPA,EAAWA,EAAS,IAExB9H,EAAMyB,MAAMuD,MAAQ8C,EACpBN,EAAkBM,IAaVC,UAAWN,EAAQd,WAMtBqB,EAAqB,SAAChI,GAA4B,MACnBsH,YAAStH,EAAMyB,MAAMwD,cAAtDA,EADoD,KACtCgD,EADsC,KAErDR,EAAUlB,IAUhB,OACI,aACI,EAAC,IAAD,CAAYmB,cAAY,GAAxB,iBACA,EAACvB,EAAD,CACIxG,IAAK,EACLC,IAAK,EACL+H,KAAM,IACNb,oBAAqBA,EACrBK,MAAOlC,EACP2C,SAjBS,SAACC,EAAYC,GACN,iBAAbA,IACPA,EAAWA,EAAS,IAExB9H,EAAMyB,MAAMwD,aAAe6C,EAC3BG,EAAgBH,IAaRC,UAAWN,EAAQd,WAMtBuB,EAAc,SAAClI,GAA4B,MAC1BsH,YAAStH,EAAMyB,MAAMyC,QAAxCiE,EAD6C,KACtCC,EADsC,KAE9CX,EAAUlB,IAUhB,OACI,aACI,EAAC,IAAD,CAAYmB,cAAY,GAAxB,mBACA,EAACvB,EAAD,CACIxG,IAAK,EACLC,IAAK,EACL+H,KAAM,EACNU,OAAK,EACLvB,oBAAqBA,EACrBK,MAAOgB,EACPP,SAlBS,SAACC,EAAYC,GACN,iBAAbA,IACPA,EAAWA,EAAS,IAExB9H,EAAMyB,MAAMyC,OAAS4D,EACrBM,EAASN,IAcDC,UAAWN,EAAQd,WAMtB2B,EAAmB,SAACtI,GAA4B,MACvBsH,YAAStH,EAAMyB,MAAMyD,WAAhDA,EADkD,KACvCqD,EADuC,KAQzD,OACI,aACI,EAACxC,EAAD,CACIyC,aAAW,SACXC,KAAK,SACLtB,MAAOjC,EACP0C,SAXS,WACjB5H,EAAMyB,MAAMyD,WAAaA,EACzBqD,GAAcrD,KAWN,EAACe,EAAD,CACIkB,OAAO,EACPuB,QAAS,EAAC7C,EAAD,MACT8C,MAAM,UAEV,EAAC1C,EAAD,CACIkB,OAAO,EACPuB,QAAS,EAAC7C,EAAD,MACT8C,MAAM,kBAObC,EAAS,SAAC5I,GAA4B,MACjBsH,YAAStH,EAAMyB,MAAM6C,SAA5CA,EADwC,KAC/BuE,EAD+B,OAEjBvB,YAAStH,EAAMyB,MAAMkD,SAA5CA,EAFwC,KAE/BmE,EAF+B,OAGvBxB,YAAStH,EAAMyB,MAAM8C,MAAtCA,EAHwC,KAGlCwE,EAHkC,KAIzCtB,EAAUlB,IAiBhB,OACI,aACI,EAACR,EAAD,CACIyC,aAAW,SACXC,KAAK,SACLtB,MAAO7C,EACPsD,SArBS,WACjB5H,EAAMyB,MAAM6C,SAAWA,EACvBuE,GAAYvE,KAqBJ,EAAC2B,EAAD,CACIkB,OAAO,EACPuB,QAAS,EAAC7C,EAAD,MACT8C,MAAM,aAEV,EAAC1C,EAAD,CACIkB,OAAO,EACPuB,QAAS,EAAC7C,EAAD,MACT8C,MAAM,aAGbrE,EACG,aACI,EAAC,IAAD,CAAYoD,cAAY,GAAxB,QACA,EAACvB,EAAD,CACIxG,IAAK,EACLC,IAAK,EACL+H,KAAM,GACNb,oBAAqBA,EACrBK,MAAO5C,EACPqD,SAjCK,SAACC,EAAYC,GAClC9H,EAAMyB,MAAM8C,KAAOuD,EACnBiB,EAAQjB,IAgCQC,UAAWN,EAAQd,UAI3B,aACI,EAAC,IAAD,CAAYe,cAAY,GAAxB,WACA,EAACvB,EAAD,CACIxG,IAAK,EACLC,IAAK,EACL+H,KAAM,IACNb,oBAAqBA,EACrBK,MAAOxC,EACPiD,SAnDQ,SAACC,EAAYC,GACrC9H,EAAMyB,MAAMkD,QAAUmD,EACtBgB,EAAWhB,IAkDKC,UAAWN,EAAQd,YAQ9BqC,EAAW,SAAChJ,GAAwB,MACvBsH,YAAStH,EAAM0B,IAAIuH,KAAlCA,EADsC,KACjCC,EADiC,OAEP5B,YAAStH,EAAM0B,IAAIyH,aAAlDA,EAFsC,KAEzBC,EAFyB,KAIvCC,EAAcJ,EAAM,QAAU,QAChCK,EAAU,IACVC,EAAU,MACd,OAAQJ,GACJ,KAAK,GACDI,EAAU,KACV,MACJ,KAAK,IACDA,EAAU,KACV,MACJ,KAAK,IACDA,EAAU,KAyBlB,OACI,aACI,EAAClD,EAAD,CAASa,MAAOmC,GACZ,EAAC,IAAD,CACIb,aAAW,OACXgB,QAAS,WACLxJ,EAAM0B,IAAIuH,KAAOA,EACjBC,GAAQD,KAIR,EADHA,EACI,IAEA,IAFD,CAAOQ,SAAS,YAM5B,EAACpD,EAAD,CAASa,MAAOqC,GACZ,EAAC,IAAD,CACIf,aAAW,WACXgB,QAAS,kBAvCC,WACtB,OAAQL,GACJ,KAAK,GACDG,EAAU,GACV,MACJ,KAAK,IACDA,EAAU,GACV,MACJ,KAAK,IACDA,EAAU,IAMlBtJ,EAAM0B,IAAIyH,YAAcG,EACxBF,EAAeE,GAuBYI,KAEf,EAAC,IAAD,CAAaD,SAAS,YAG9B,EAACpD,EAAD,CAASa,MAAM,SACX,EAAC,IAAD,CACIsB,aAAW,UACXgB,QAAS,kBAAMxJ,EAAM0B,IAAIiI,YAEzB,EAAC,IAAD,CAAYF,SAAS,gB,6DCpTzC,kGAMaG,EAAQ,SAAC5J,GAClB,IAAMC,EAASC,YAAiC,MA0BhD,OAJAmC,aAAU,WApBG,wCAgBL,OADArC,EAAM0B,IAAIvB,KAAKC,GACf,gBAAMzD,YAAMqD,EAAM0B,IAAIyH,cAAtB,MAAkC,mDAhB7B,4BAGH/I,EAKFyJ,EARK,EACT,GAAsB,MAAlB5J,EAAO0B,QAAiB,WAG5B,GAAW,OADLvB,EAAMH,EAAO0B,QAAQC,WAAW,OACrB,WAKjB,IAHAxB,EAAIyB,UAAUf,IAAWA,KAErB+I,EAAQ,IACJ5K,eACJtC,YAAMkN,GACNA,GAAgB,EAXX,6LAyBT,YACIvH,OAAQ,EAAItC,EAAM0B,IAAIpB,GAAKQ,IAC3ByB,QAAS,EAAIvC,EAAM0B,IAAInB,GAAKO,IAC5B0B,IAAKvC,O,4YC2KV,SAAS6J,EAAUvJ,EAAWD,GAEjC,OADY,IAAIyJ,EAAIxJ,EAAGD,G,oKA1MdyJ,EAAb,WAYI,WAAYxH,EAAgBD,GAAe,0IAJrC,GAIqC,2BAHxB,GAGwB,qBAF7B,KAGVY,KAAK8G,KAAO,EACZ9G,KAAKqC,EAAI,EACTrC,KAAK5C,EAAIgC,EACTY,KAAK3C,EAAIgC,EACTW,KAAK+G,OAAS,GACd/G,KAAKxB,IAAM,GACX,IAAK,IAAIhB,EAAI,EAAGA,EAAI4B,EAAO5B,IAAK,CAC5B,IAAMwJ,EAAS,IAAIrG,MAAMtB,GACzBW,KAAKxB,IAAImB,KAAKqH,IArB1B,2BAyBIC,SAAA,SAASpG,GACLb,KAAK+G,OAAOpH,KAAKkB,IA1BzB,EA6BIqG,WAAA,SAAWC,EAAY9G,EAAWC,GAC9BN,KAAKxB,IAAI6B,GAAGC,GAAK6G,GA9BzB,EAiCIV,QAAA,WACIzG,KAAKqC,EAAI,EACTrC,KAAK8G,KAAO,EACZ,MAAoB9G,KAAK+G,OAAzB,wDAAiC,yFAAtBxI,EAAsB,EAC7BA,EAAMkC,MAAMT,KAAK3C,EAAG2C,KAAK5C,GACzBmB,EAAMqC,WAtClB,EA0CI3D,KAAA,SAAKC,GACD,GAAK8C,KAAK+F,KAAQ/F,KAAKoH,iBAAvB,CACApH,KAAKoH,kBAAmB,EAExBlK,EAAIwF,UAAU5I,IAAQM,cAAewD,KAAYA,KACjDV,EAAIwF,UAAU5I,IAAQO,cAAeuD,IAAYoC,KAAK5C,GAAIQ,KAC1D,IAAK,IAAIJ,EAAI,EAAGA,EAAIwC,KAAK5C,EAAGI,IACxBN,EAAIwF,UAAU5I,IAAQG,UAAW2D,IAAYJ,GAAII,KAErD,IAAK,IAAIH,EAAI,EAAGA,EAAIuC,KAAK3C,EAAGI,IACxB,IAAK,IAAID,EAAI,EAAGA,EAAIwC,KAAK5C,EAAGI,IACxBN,EAAIwF,UAAU5I,IAAQC,OAAQ6D,IAAYJ,EAAGI,IAAYH,GAGjE,IAAK,IAAIA,EAAI,EAAGA,EAAIuC,KAAK3C,EAAGI,IACxBP,EAAIwF,UAAU5I,IAAQI,YAAa0D,IAAWA,IAAYH,GAC1DP,EAAIwF,UACA5I,IAAQK,YACRyD,IAAYoC,KAAK5C,EACjBQ,IAAYH,GAGpB,IAAK,IAAIA,EAAI,EAAGA,EAAIuC,KAAK3C,EAAGI,IAExB,IAAK,IAAID,EAAI,EAAGA,EAAIwC,KAAK5C,EAAGI,IAAK,CAC7B,IAAM6J,EAAMrH,KAAKxB,IAAIhB,GAAGC,GACb6J,MAAPD,GAAkBA,EAAIpK,KAAKC,EAAKM,EAAGC,EAAGuC,KAAKqC,GAC/CrC,KAAKuH,UAAUrK,EAAKM,EAAGC,GAG/B,IAAK,IAAID,EAAI,EAAGA,EAAIwC,KAAK5C,EAAGI,IACxBN,EAAIwF,UACA5I,IAAQQ,aACRsD,IAAYJ,EACZI,IAAYoC,KAAK3C,GAErBH,EAAIwF,UACA5I,IAAQS,cACRqD,IAAYJ,EACZI,KAAaoC,KAAK3C,EAAI,IAqB9B,GAlBAH,EAAIwF,UAAU5I,IAAQU,kBAAmBoD,IAAWA,IAAYoC,KAAK3C,GACrEH,EAAIwF,UACA5I,IAAQW,mBACPmD,IACDA,KAAaoC,KAAK3C,EAAI,IAE1BH,EAAIwF,UACA5I,IAAQY,kBACRkD,IAAYoC,KAAK5C,EACjBQ,IAAYoC,KAAK3C,GAErBH,EAAIwF,UACA5I,IAAQa,mBACRiD,IAAYoC,KAAK5C,EACjBQ,KAAaoC,KAAK3C,EAAI,IAG1B2C,KAAKqC,IACDrC,KAAKqC,EAAI,GAAK,EAAlB,CAGArC,KAAK8G,OAEL,MAAoB9G,KAAK+G,OAAzB,wDAAiC,yFAAtBxI,EAAsB,EACvBiJ,EAASjJ,EAAM4C,eACrB,GAAkCmG,MAA9BtH,KAAKxB,IAAID,EAAM8B,GAAG9B,EAAM+B,GAA5B,CAKA,IAAImH,EAAOlJ,EAAM8B,EACbqH,EAAOnJ,EAAM+B,EACjB,OAAQkH,GACJ,KAAK1J,IACGS,EAAM+B,EAAI,GAAGoH,IACjB,MACJ,KAAKvJ,IACGI,EAAM8B,EAAIL,KAAK5C,EAAI,GAAGqK,IAC1B,MACJ,KAAKrJ,IACGG,EAAM+B,EAAIN,KAAK3C,EAAI,GAAGqK,IAC1B,MACJ,KAAKrJ,IACGE,EAAM8B,EAAI,GAAGoH,IAGzB,IAAMJ,EAAMrH,KAAKxB,IAAIiJ,GAAMC,GAEvBnJ,EAAM2D,UADCoF,MAAPD,EACgBA,EAAIM,OACD,GACvBpJ,EAAM4D,YAAYsF,EAAMC,QAxBpBnJ,EAAMqC,aA9GtB,EA0II2G,UAAA,SAAUrK,EAA+BmD,EAAWC,GAChD,MAAoBN,KAAK+G,OAAzB,wDAAiC,uFACnB1G,GAAKA,GADc,EACHC,GAAKA,GADF,EAEnBrD,KAAKC,EAAK8C,KAAKqC,KA7IrC,KAmJeuF,E,qHAKX3K,KAAA,a,KAGS4K,EAAb,qKACgB,GADhB,gBAEa,GAFb,gBAGY,GAHZ,4BAKI5K,KAAA,SAAKC,EAA+BmD,EAAWC,GAC3CpD,EAAIwF,UAAU5I,IAAQ6B,MAAOiC,IAAYyC,EAAGzC,KAAa0C,EAAI,MAC7DpD,EAAIwF,UAAU5I,IAAQ+B,YAAa+B,IAAYyC,EAAGzC,IAAY0C,IAPtE,GAA4BsH,GAWfE,EAAb,qKACgB,GADhB,gBAEa,IAFb,gBAGY,GAHZ,4BAKI7K,KAAA,SAAKC,EAA+BmD,EAAWC,GAC3CpD,EAAIwF,UAAU5I,IAAQ8B,SAAUgC,IAAYyC,EAAGzC,KAAa0C,EAAI,MAChEpD,EAAIwF,UAAU5I,IAAQ+B,YAAa+B,IAAYyC,EAAGzC,IAAY0C,IAPtE,GAAiCsH,GAWpBG,EAAb,qKACgB,GADhB,iBAEc,GAFd,gBAGY,GAHZ,4BAKI9K,KAAA,SAAKC,EAA+BmD,EAAWC,EAAW+B,GACtD,OAAQA,EAAI,GACR,KAAK,EACDnF,EAAIwF,UAAU5I,IAAQc,OAAQgD,IAAYyC,EAAGzC,IAAY0C,GACzD,MACJ,KAAK,EACDpD,EAAIwF,UAAU5I,IAAQe,QAAS+C,IAAYyC,EAAGzC,IAAY0C,GAC1D,MACJ,KAAK,EACDpD,EAAIwF,UAAU5I,IAAQc,OAAQgD,IAAYyC,EAAGzC,IAAY0C,GACzD,MACJ,KAAK,EACDpD,EAAIwF,UAAU5I,IAAQgB,QAAS8C,IAAYyC,EAAGzC,IAAY0C,KAjB1E,GAA6BsH","file":"route-cliff/index.tsx~route-home/index.tsx~route-multi/index.tsx~route-parameters/index.tsx~route-po~a41bf43c.chunk.5db9a.js","sourcesContent":["export function sleep(ms: number) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n","const sprites: { [string]: HTMLImageElement } = {\n    ground: new Image(),\n    borderTop: new Image(),\n    borderLeft: new Image(),\n    borderRight: new Image(),\n    borderLeftUp: new Image(),\n    borderRightUp: new Image(),\n    borderBottom: new Image(),\n    borderBottom2: new Image(),\n    borderBottomLeft: new Image(),\n    borderBottomLeft2: new Image(),\n    borderBottomRight: new Image(),\n    borderBottomRight2: new Image(),\n\n    goomba: new Image(),\n    goomba2: new Image(),\n    goomba3: new Image(),\n\n    marioFace: new Image(),\n    marioFace1: new Image(),\n    marioFace2: new Image(),\n    marioLeft: new Image(),\n    marioLeft1: new Image(),\n    marioLeft2: new Image(),\n    marioRight: new Image(),\n    marioRight1: new Image(),\n    marioRight2: new Image(),\n    marioBack: new Image(),\n    marioBack1: new Image(),\n    marioBack2: new Image(),\n\n    block: new Image(),\n    redBlock: new Image(),\n    blockShadow: new Image()\n};\n\nsprites.ground.src = \"assets/ground.png\";\nsprites.borderTop.src = \"assets/border_top.png\";\nsprites.borderLeft.src = \"assets/border_left.png\";\nsprites.borderRight.src = \"assets/border_right.png\";\nsprites.borderLeftUp.src = \"assets/border_left_up.png\";\nsprites.borderRightUp.src = \"assets/border_right_up.png\";\nsprites.borderBottom.src = \"assets/border_bottom.png\";\nsprites.borderBottom2.src = \"assets/border_bottom2.png\";\nsprites.borderBottomLeft.src = \"assets/border_bottom_left.png\";\nsprites.borderBottomLeft2.src = \"assets/border_bottom_left2.png\";\nsprites.borderBottomRight.src = \"assets/border_bottom_right.png\";\nsprites.borderBottomRight2.src = \"assets/border_bottom_right2.png\";\n\nsprites.goomba.src = \"assets/goomba.png\";\nsprites.goomba2.src = \"assets/goomba2.png\";\nsprites.goomba3.src = \"assets/goomba3.png\";\n\nsprites.marioFace.src = \"assets/mario_front.png\";\nsprites.marioFace1.src = \"assets/mario_front1.png\";\nsprites.marioFace2.src = \"assets/mario_front2.png\";\nsprites.marioBack.src = \"assets/mario_back.png\";\nsprites.marioBack1.src = \"assets/mario_back1.png\";\nsprites.marioBack2.src = \"assets/mario_back2.png\";\nsprites.marioRight.src = \"assets/mario_right.png\";\nsprites.marioRight1.src = \"assets/mario_right1.png\";\nsprites.marioRight2.src = \"assets/mario_right2.png\";\nsprites.marioLeft.src = \"assets/mario_left.png\";\nsprites.marioLeft1.src = \"assets/mario_left1.png\";\nsprites.marioLeft2.src = \"assets/mario_left2.png\";\n\nsprites.block.src = \"assets/block.png\";\nsprites.redBlock.src = \"assets/red_block.png\";\nsprites.blockShadow.src = \"assets/block_shadow.png\";\n\nexport const loaded = () => {\n    let res = true;\n    for (let img in sprites) {\n        res = res && sprites[img].complete;\n    }\n    return res;\n};\n\nexport default sprites;\n","import * as preact from \"preact\";\nimport { useRef, useEffect } from \"preact/hooks\";\nimport { blockSize, UP, BOTTOM, RIGHT, LEFT } from \"./core/const\";\nimport { sleep } from \"./core/utils\";\nimport { Map } from \"./core/map\";\nimport Agent from \"./core/agent\";\n\nconst color1 = [255, 0, 255];\nconst color2 = [0, 255, 255];\n\nconst getColor = (q: number) => {\n    const percent = Math.min(1, Math.max(0, 1 / (1 + Math.exp(-3 * q))));\n    return `rgb(\n        ${Math.floor(color2[0] + (color1[0] - color2[0]) * percent)},\n        ${Math.floor(color2[1] + (color1[1] - color2[1]) * percent)},\n        ${Math.floor(color2[2] + (color1[2] - color2[2]) * percent)})`;\n};\n\nconst drawScale = (ctx: CanvasRenderingContext2D, w: number, h: number) => {\n    ctx.strokeStyle = \"#000000\";\n    const gradient = ctx.createLinearGradient(\n        0,\n        (0.5 + h) * blockSize,\n        w * blockSize,\n        (0.9 + h) * blockSize\n    );\n    gradient.addColorStop(1, `rgb(${color1[0]},${color1[1]},${color1[2]})`);\n    gradient.addColorStop(0, `rgb(${color2[0]},${color2[1]},${color2[2]})`);\n    ctx.fillStyle = gradient;\n    ctx.strokeRect(0, (0.5 + h) * blockSize, w * blockSize, 0.4 * blockSize);\n    ctx.fillRect(0, (0.5 + h) * blockSize, w * blockSize, 0.4 * blockSize);\n\n    ctx.font = \"14px sans-serif\";\n    ctx.textAlign = \"center\";\n    ctx.fillStyle = \"#000000\";\n    ctx.fillText(\"0\", (w * blockSize) / 2, (1.5 + h) * blockSize);\n    ctx.fillText(\"+∞\", w * blockSize, (1.5 + h) * blockSize);\n    ctx.fillText(\"-∞\", 0, (1.5 + h) * blockSize);\n};\n\nconst drawQValues = (\n    ctx: CanvasRenderingContext2D,\n    Q: number[][][],\n    w: number,\n    h: number\n) => {\n    ctx.strokeStyle = \"#000000\";\n    ctx.lineWidth = 1;\n    for (let i = 0; i < w; i++) {\n        for (let j = 0; j < h; j++) {\n            ctx.fillStyle = getColor(0);\n            ctx.fillRect(i * blockSize, j * blockSize, blockSize, blockSize);\n            ctx.strokeRect(i * blockSize, j * blockSize, blockSize, blockSize);\n\n            ctx.fillStyle = getColor(Q[i][j][UP]);\n            ctx.beginPath();\n            ctx.moveTo((i + 0.5) * blockSize, (j + 0.5) * blockSize);\n            ctx.lineTo((i + 1) * blockSize, j * blockSize);\n            ctx.lineTo(i * blockSize, j * blockSize);\n            ctx.fill();\n\n            ctx.fillStyle = getColor(Q[i][j][RIGHT]);\n            ctx.beginPath();\n            ctx.moveTo((i + 0.5) * blockSize, (j + 0.5) * blockSize);\n            ctx.lineTo((i + 1) * blockSize, j * blockSize);\n            ctx.lineTo((i + 1) * blockSize, (j + 1) * blockSize);\n            ctx.fill();\n\n            ctx.fillStyle = getColor(Q[i][j][BOTTOM]);\n            ctx.beginPath();\n            ctx.moveTo((i + 0.5) * blockSize, (j + 0.5) * blockSize);\n            ctx.lineTo((i + 1) * blockSize, (j + 1) * blockSize);\n            ctx.lineTo(i * blockSize, (j + 1) * blockSize);\n            ctx.fill();\n\n            ctx.fillStyle = getColor(Q[i][j][LEFT]);\n            ctx.beginPath();\n            ctx.moveTo((i + 0.5) * blockSize, (j + 0.5) * blockSize);\n            ctx.lineTo(i * blockSize, (j + 1) * blockSize);\n            ctx.lineTo(i * blockSize, j * blockSize);\n            ctx.fill();\n        }\n    }\n};\n\nexport const HeatMap = (props: { map: Map; agent: Agent }) => {\n    const canvas = useRef<null | HTMLCanvasElement>(null);\n\n    const draw = async () => {\n        if (canvas.current == null) return;\n\n        const ctx = canvas.current.getContext(\"2d\");\n        if (ctx == null) return;\n\n        ctx.translate(blockSize, blockSize);\n\n        drawScale(ctx, props.map.w, props.map.h);\n        while (true) {\n            drawQValues(ctx, props.agent.Q, props.map.w, props.map.h);\n            await sleep(200);\n        }\n    };\n\n    useEffect(() => {\n        draw();\n    });\n\n    return (\n        <canvas\n            width={(2 + props.map.w) * blockSize}\n            height={(3 + props.map.h) * blockSize}\n            ref={canvas}\n            // style=\"margin:2rem\"\n        />\n    );\n};\n","export const UP = 0;\nexport const RIGHT = 1;\nexport const BOTTOM = 2;\nexport const LEFT = 3;\n\nexport const blockSize = 24;\n","export const greedy = (Q: number[]) => {\n    let max = -Infinity;\n    let maxIdx: number[] = [];\n    for (let i = 0; i < Q.length; i++) {\n        if (Q[i] > max) {\n            maxIdx = [i];\n            max = Q[i];\n        } else if (Q[i] == max) {\n            maxIdx.push(i);\n        }\n    }\n\n    if (maxIdx.length == 1) return maxIdx[0];\n    return maxIdx[Math.floor(Math.random() * maxIdx.length)];\n};\n\nexport const epsilonGreedy = (epsilon: number, Q: number[]) => {\n    if (Math.random() < epsilon) {\n        return Math.floor(Math.random() * Q.length);\n    }\n    return greedy(Q);\n};\n\nexport const softmax = (beta: number, Q: number[]) => {\n    let total = 0;\n    for (let i = 0; i < 4; i++) {\n        total += Math.exp(beta * Q[i]);\n    }\n\n    const r = Math.random();\n    let cumsum = 0;\n    for (let i = 0; i < 4; i++) {\n        cumsum += Math.exp(beta * Q[i]) / total;\n        if (cumsum >= r) {\n            return i;\n        }\n    }\n    return 3;\n};\n","import sprites from \"./sprites\";\nimport { RIGHT, LEFT, UP, BOTTOM, blockSize } from \"./const\";\nimport { epsilonGreedy, greedy, softmax } from \"./policies\";\n\nconst nbActions = 4;\n\nexport default class Agent {\n    Q: number[][][] = [[[]]];\n    learningRate = 0.3;\n    gamma = 0.8;\n    epsilon = 0.2;\n    beta = 3;\n    softmax = false;\n    QLearning = false;\n    nSteps = 1;\n    x: number;\n    y: number;\n    lastX: number[];\n    lastY: number[];\n    lastRewards: number[] = [];\n    lastActions: number[] = [];\n    lastGreedyAction: number;\n    initialPositionX = 0;\n    initialPositionY = 0;\n\n    constructor(\n        height: number,\n        width: number,\n        initialX?: number,\n        initialY?: number\n    ) {\n        this.lastActions = [BOTTOM];\n        this.lastGreedyAction = BOTTOM;\n        this.initialPositionX = initialX || 0;\n        this.initialPositionY = initialY || 0;\n        this.x = this.initialPositionX;\n        this.y = this.initialPositionY;\n        this.lastX = [this.initialPositionX];\n        this.lastY = [this.initialPositionY];\n        this.initQ(height, width);\n    }\n\n    initQ(height: number, width: number) {\n        this.Q = [];\n        for (let i = 0; i < width; i++) {\n            const Qrow: number[][] = [];\n            for (let j = 0; j < height; j++) {\n                Qrow.push(new Array(nbActions).fill(0));\n            }\n            this.Q.push(Qrow);\n        }\n    }\n\n    newRun() {\n        const a = this.lastActions?.shift() || BOTTOM;\n        for (let n = this.nSteps; n > 0; n--) {\n            this.reinforce(n, a);\n        }\n\n        this.x = this.initialPositionX;\n        this.y = this.initialPositionY;\n        this.lastX = [this.initialPositionX];\n        this.lastY = [this.initialPositionY];\n        this.lastRewards = [];\n        this.lastActions = [BOTTOM];\n    }\n\n    chooseAction() {\n        const Q = this.Q[this.x][this.y];\n        let a: number;\n        if (this.softmax) {\n            a = softmax(this.beta, Q);\n        } else a = epsilonGreedy(this.epsilon, Q);\n        this.lastGreedyAction = greedy(Q);\n\n        this.reinforce(this.nSteps, a);\n        this.lastActions.unshift(a);\n        return a;\n    }\n\n    reinforce(n: number, a: number) {\n        if (this.lastRewards.length < n) {\n            return;\n        }\n        let deltaQ = -this.Q[this.lastX[n - 1]][this.lastY[n - 1]][\n            this.lastActions[n - 1]\n        ];\n        let discount = 1;\n        for (let i = n - 1; i >= 0; i--) {\n            deltaQ += this.lastRewards[i] * discount;\n            discount *= this.gamma;\n        }\n\n        if (this.QLearning) {\n            deltaQ += discount * this.Q[this.x][this.y][this.lastGreedyAction];\n        } else {\n            deltaQ += discount * this.Q[this.x][this.y][a];\n        }\n\n        this.Q[this.lastX[n - 1]][this.lastY[n - 1]][this.lastActions[n - 1]] +=\n            this.learningRate * deltaQ;\n\n        // Free memory\n        this.lastActions.pop();\n        this.lastRewards.pop();\n        this.lastX.pop();\n        this.lastY.pop();\n    }\n\n    getReward(r: number) {\n        this.lastRewards.unshift(r);\n    }\n\n    newPosition(x: number, y: number) {\n        this.lastX.unshift(this.x);\n        this.lastY.unshift(this.y);\n        this.x = x;\n        this.y = y;\n    }\n\n    getSprite(t: number) {\n        switch (this.lastActions[0]) {\n            case UP:\n                switch (t % 4) {\n                    case 0:\n                        return sprites.marioBack;\n                    case 1:\n                        return sprites.marioBack1;\n                    case 2:\n                        return sprites.marioBack;\n                    case 3:\n                        return sprites.marioBack2;\n                }\n            case RIGHT:\n                switch (t % 4) {\n                    case 0:\n                        return sprites.marioRight;\n                    case 1:\n                        return sprites.marioRight1;\n                    case 2:\n                        return sprites.marioRight;\n                    case 3:\n                        return sprites.marioRight2;\n                }\n            case BOTTOM:\n                switch (t % 4) {\n                    case 0:\n                        return sprites.marioFace;\n                    case 1:\n                        return sprites.marioFace1;\n                    case 2:\n                        return sprites.marioFace;\n                    case 3:\n                        return sprites.marioFace2;\n                }\n            case LEFT:\n                switch (t % 4) {\n                    case 0:\n                        return sprites.marioLeft;\n                    case 1:\n                        return sprites.marioLeft1;\n                    case 2:\n                        return sprites.marioLeft;\n                    case 3:\n                        return sprites.marioLeft2;\n                }\n            default:\n                console.log(\n                    \"Failed to get sprite for agent: \" + this.lastActions\n                );\n                return sprites.marioFace;\n        }\n    }\n\n    draw(ctx: CanvasRenderingContext2D, t: number) {\n        const dx = ((this.x - this.lastX[0]) * ((t % 4) + 1)) / 4;\n        const dy = ((this.y - this.lastY[0]) * ((t % 4) + 1)) / 4;\n\n        ctx.drawImage(\n            this.getSprite(t),\n            blockSize * (this.lastX[0] + dx),\n            blockSize * (this.lastY[0] + dy) - blockSize / 2\n        );\n    }\n}\n","import * as preact from \"preact\";\nimport { useState } from \"preact/hooks\";\nimport { makeStyles, Theme, createStyles } from \"@material-ui/core/styles\";\nimport SliderTMP from \"@material-ui/core/Slider\";\nimport TooltipTMP from \"@material-ui/core/Tooltip\";\nimport RadioTMP from \"@material-ui/core/Radio\";\nimport RadioGroupTMP from \"@material-ui/core/RadioGroup\";\nimport FormControlLabelTMP from \"@material-ui/core/FormControlLabel\";\nimport Typography from \"@material-ui/core/Typography\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport CachedIcon from \"@material-ui/icons/Cached\";\nimport PlayArrow from \"@material-ui/icons/PlayArrow\";\nimport Pause from \"@material-ui/icons/Pause\";\nimport FastForward from \"@material-ui/icons/FastForward\";\nimport { Map } from \"./core/map\";\nimport Agent from \"./core/agent\";\n\n// Todo: remove this, it is a Workaround for https://github.com/preactjs/preact-cli/issues/1030\nconst Radio: any = RadioTMP as any;\nconst RadioGroup: any = RadioGroupTMP as any;\nconst FormControlLabel: any = FormControlLabelTMP as any;\nconst Slider: any = SliderTMP as any;\nconst Tooltip: any = TooltipTMP as any;\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        slider: {\n            width: 100 + theme.spacing(3) * 2\n        },\n        margin: {\n            height: theme.spacing(3)\n        }\n    })\n);\n\ninterface IToolTipProps {\n    children: React.ReactElement;\n    open: boolean;\n    value: number;\n}\n\n// Todo: remove any, it is a Workaround for https://github.com/preactjs/preact-cli/issues/1030\nconst ValueLabelComponent: any = (props: IToolTipProps) => {\n    const { children, open, value } = props;\n\n    return (\n        <Tooltip open={open} enterTouchDelay={0} placement=\"top\" title={value}>\n            {children}\n        </Tooltip>\n    );\n};\n\nexport const DiscountFactorPicker = (props: { agent: Agent }) => {\n    const [discountFactor, setdiscountFactor] = useState(props.agent.gamma);\n    const classes = useStyles();\n\n    const handleChange = (event: any, newValue: number | number[]) => {\n        if (typeof newValue !== \"number\") {\n            newValue = newValue[0];\n        }\n        props.agent.gamma = newValue;\n        setdiscountFactor(newValue);\n    };\n\n    return (\n        <div>\n            <Typography gutterBottom>Discount factor</Typography>\n            <Slider\n                min={0}\n                max={1}\n                step={0.02}\n                ValueLabelComponent={ValueLabelComponent}\n                value={discountFactor}\n                onChange={handleChange}\n                className={classes.slider}\n            />\n        </div>\n    );\n};\n\nexport const LearningRatePicker = (props: { agent: Agent }) => {\n    const [learningRate, setLearningRate] = useState(props.agent.learningRate);\n    const classes = useStyles();\n\n    const handleChange = (event: any, newValue: number | number[]) => {\n        if (typeof newValue !== \"number\") {\n            newValue = newValue[0];\n        }\n        props.agent.learningRate = newValue;\n        setLearningRate(newValue);\n    };\n\n    return (\n        <div>\n            <Typography gutterBottom>Learning rate</Typography>\n            <Slider\n                min={0}\n                max={1}\n                step={0.02}\n                ValueLabelComponent={ValueLabelComponent}\n                value={learningRate}\n                onChange={handleChange}\n                className={classes.slider}\n            />\n        </div>\n    );\n};\n\nexport const StepsPicker = (props: { agent: Agent }) => {\n    const [steps, setSteps] = useState(props.agent.nSteps);\n    const classes = useStyles();\n\n    const handleChange = (event: any, newValue: number | number[]) => {\n        if (typeof newValue !== \"number\") {\n            newValue = newValue[0];\n        }\n        props.agent.nSteps = newValue;\n        setSteps(newValue);\n    };\n\n    return (\n        <div>\n            <Typography gutterBottom>Number of steps</Typography>\n            <Slider\n                min={1}\n                max={4}\n                step={1}\n                marks\n                ValueLabelComponent={ValueLabelComponent}\n                value={steps}\n                onChange={handleChange}\n                className={classes.slider}\n            />\n        </div>\n    );\n};\n\nexport const LearningStrategy = (props: { agent: Agent }) => {\n    const [QLearning, setQLearning] = useState(props.agent.QLearning);\n\n    const handleChange = () => {\n        props.agent.QLearning = !QLearning;\n        setQLearning(!QLearning);\n    };\n\n    return (\n        <div>\n            <RadioGroup\n                aria-label=\"Policy\"\n                name=\"Policy\"\n                value={QLearning}\n                onChange={handleChange}\n            >\n                <FormControlLabel\n                    value={false}\n                    control={<Radio />}\n                    label=\"Sarsa\"\n                />\n                <FormControlLabel\n                    value={true}\n                    control={<Radio />}\n                    label=\"Q-learning\"\n                />\n            </RadioGroup>\n        </div>\n    );\n};\n\nexport const Policy = (props: { agent: Agent }) => {\n    const [softmax, setSoftmax] = useState(props.agent.softmax);\n    const [epsilon, setEpsilon] = useState(props.agent.epsilon);\n    const [beta, setBeta] = useState(props.agent.beta);\n    const classes = useStyles();\n\n    const handleChange = () => {\n        props.agent.softmax = !softmax;\n        setSoftmax(!softmax);\n    };\n\n    const handleEpsilonChange = (event: any, newValue: number) => {\n        props.agent.epsilon = newValue;\n        setEpsilon(newValue);\n    };\n\n    const handleBetaChange = (event: any, newValue: number) => {\n        props.agent.beta = newValue;\n        setBeta(newValue);\n    };\n\n    return (\n        <div>\n            <RadioGroup\n                aria-label=\"Policy\"\n                name=\"Policy\"\n                value={softmax}\n                onChange={handleChange}\n            >\n                <FormControlLabel\n                    value={false}\n                    control={<Radio />}\n                    label=\"ε-greedy\"\n                />\n                <FormControlLabel\n                    value={true}\n                    control={<Radio />}\n                    label=\"Softmax\"\n                />\n            </RadioGroup>\n            {softmax ? (\n                <div>\n                    <Typography gutterBottom>Beta</Typography>\n                    <Slider\n                        min={1}\n                        max={8}\n                        step={0.1}\n                        ValueLabelComponent={ValueLabelComponent}\n                        value={beta}\n                        onChange={handleBetaChange}\n                        className={classes.slider}\n                    />\n                </div>\n            ) : (\n                <div>\n                    <Typography gutterBottom>Epsilon</Typography>\n                    <Slider\n                        min={0}\n                        max={1}\n                        step={0.02}\n                        ValueLabelComponent={ValueLabelComponent}\n                        value={epsilon}\n                        onChange={handleEpsilonChange}\n                        className={classes.slider}\n                    />\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport const Activate = (props: { map: Map }) => {\n    const [run, setRun] = useState(props.map.run);\n    const [refreshRate, setRefreshRate] = useState(props.map.refreshRate);\n\n    const playTooltip = run ? \"Pause\" : \"Start\";\n    let newRate = 200;\n    let speedup = \"x20\";\n    switch (refreshRate) {\n        case 25:\n            speedup = \"x8\";\n            break;\n        case 100:\n            speedup = \"x2\";\n            break;\n        case 200:\n            speedup = \"x1\";\n            break;\n        default:\n            break;\n    }\n\n    const updateRefreshRate = () => {\n        switch (refreshRate) {\n            case 25:\n                newRate = 10;\n                break;\n            case 100:\n                newRate = 25;\n                break;\n            case 200:\n                newRate = 100;\n                break;\n            default:\n                break;\n        }\n\n        props.map.refreshRate = newRate;\n        setRefreshRate(newRate);\n    };\n\n    return (\n        <div>\n            <Tooltip title={playTooltip}>\n                <IconButton\n                    aria-label=\"Play\"\n                    onClick={() => {\n                        props.map.run = !run;\n                        setRun(!run);\n                    }}\n                >\n                    {run ? (\n                        <Pause fontSize=\"small\" />\n                    ) : (\n                        <PlayArrow fontSize=\"small\" />\n                    )}\n                </IconButton>\n            </Tooltip>\n            <Tooltip title={speedup}>\n                <IconButton\n                    aria-label=\"Speed up\"\n                    onClick={() => updateRefreshRate()}\n                >\n                    <FastForward fontSize=\"small\" />\n                </IconButton>\n            </Tooltip>\n            <Tooltip title=\"Reset\">\n                <IconButton\n                    aria-label=\"Restart\"\n                    onClick={() => props.map.restart()}\n                >\n                    <CachedIcon fontSize=\"small\" />\n                </IconButton>\n            </Tooltip>\n        </div>\n    );\n};\n","import * as preact from \"preact\";\nimport { useRef, useEffect } from \"preact/hooks\";\nimport { Map } from \"./core/map\";\nimport { blockSize } from \"./core/const\";\nimport { sleep } from \"./core/utils\";\nimport { loaded } from \"./core/sprites\";\n\nexport const Arena = (props: { map: Map }) => {\n    const canvas = useRef<null | HTMLCanvasElement>(null);\n\n    const draw = async () => {\n        if (canvas.current == null) return;\n\n        const ctx = canvas.current.getContext(\"2d\");\n        if (ctx == null) return;\n\n        ctx.translate(blockSize, blockSize);\n\n        let delay = 20;\n        while (!loaded()) {\n            sleep(delay);\n            delay = delay * 2;\n        }\n\n        while (true) {\n            props.map.draw(ctx);\n            await sleep(props.map.refreshRate);\n        }\n    };\n\n    useEffect(() => {\n        draw();\n    });\n\n    return (\n        <canvas\n            width={(2 + props.map.w) * blockSize}\n            height={(3 + props.map.h) * blockSize}\n            ref={canvas}\n        />\n    );\n};\n","import sprites from \"./sprites\";\nimport Agent from \"./agent\";\nimport { epsilonGreedy } from \"./policies\";\nimport { RIGHT, LEFT, UP, BOTTOM, blockSize } from \"./const\";\n\n// const height = 6;\n// const width = 4;\n\nexport class Map {\n    map: (Element | undefined)[][];\n    agents: Agent[];\n    w: number;\n    h: number;\n    t: number;\n    turn: number;\n\n    run = false;\n    initialRendering = true;\n    refreshRate = 200; // in ms\n\n    constructor(height: number, width: number) {\n        this.turn = 0;\n        this.t = 0;\n        this.w = width;\n        this.h = height;\n        this.agents = [];\n        this.map = [];\n        for (let i = 0; i < width; i++) {\n            const MapRow = new Array(height);\n            this.map.push(MapRow);\n        }\n    }\n\n    addAgent(a: Agent) {\n        this.agents.push(a);\n    }\n\n    addElement(e: Element, x: number, y: number) {\n        this.map[x][y] = e;\n    }\n\n    restart() {\n        this.t = 0;\n        this.turn = 0;\n        for (const agent of this.agents) {\n            agent.initQ(this.h, this.w);\n            agent.newRun();\n        }\n    }\n\n    draw(ctx: CanvasRenderingContext2D) {\n        if (!this.run && !this.initialRendering) return;\n        this.initialRendering = false;\n\n        ctx.drawImage(sprites.borderLeftUp, -blockSize, -blockSize);\n        ctx.drawImage(sprites.borderRightUp, blockSize * this.w, -blockSize);\n        for (let i = 0; i < this.w; i++) {\n            ctx.drawImage(sprites.borderTop, blockSize * i, -blockSize);\n        }\n        for (let j = 0; j < this.h; j++) {\n            for (let i = 0; i < this.w; i++) {\n                ctx.drawImage(sprites.ground, blockSize * i, blockSize * j);\n            }\n        }\n        for (let j = 0; j < this.h; j++) {\n            ctx.drawImage(sprites.borderLeft, -blockSize, blockSize * j);\n            ctx.drawImage(\n                sprites.borderRight,\n                blockSize * this.w,\n                blockSize * j\n            );\n        }\n        for (let j = 0; j < this.h; j++) {\n            // Draw ground, elts and agents\n            for (let i = 0; i < this.w; i++) {\n                const elt = this.map[i][j];\n                if (elt != undefined) elt.draw(ctx, i, j, this.t);\n                this.drawAgent(ctx, i, j);\n            }\n        }\n        for (let i = 0; i < this.w; i++) {\n            ctx.drawImage(\n                sprites.borderBottom,\n                blockSize * i,\n                blockSize * this.h\n            );\n            ctx.drawImage(\n                sprites.borderBottom2,\n                blockSize * i,\n                blockSize * (this.h + 1)\n            );\n        }\n        ctx.drawImage(sprites.borderBottomLeft, -blockSize, blockSize * this.h);\n        ctx.drawImage(\n            sprites.borderBottomLeft2,\n            -blockSize,\n            blockSize * (this.h + 1)\n        );\n        ctx.drawImage(\n            sprites.borderBottomRight,\n            blockSize * this.w,\n            blockSize * this.h\n        );\n        ctx.drawImage(\n            sprites.borderBottomRight2,\n            blockSize * this.w,\n            blockSize * (this.h + 1)\n        );\n\n        this.t++;\n        if (this.t % 4 != 0) return;\n\n        // If a new turn begin\n        this.turn++;\n\n        for (const agent of this.agents) {\n            const action = agent.chooseAction();\n            if (this.map[agent.x][agent.y] != undefined) {\n                agent.newRun();\n                continue;\n            }\n\n            let newX = agent.x;\n            let newY = agent.y;\n            switch (action) {\n                case UP:\n                    if (agent.y > 0) newY--;\n                    break;\n                case RIGHT:\n                    if (agent.x < this.w - 1) newX++;\n                    break;\n                case BOTTOM:\n                    if (agent.y < this.h - 1) newY++;\n                    break;\n                case LEFT:\n                    if (agent.x > 0) newX--;\n                    break;\n            }\n            const elt = this.map[newX][newY];\n            if (elt != undefined) {\n                agent.getReward(elt.reward);\n            } else agent.getReward(0);\n            agent.newPosition(newX, newY);\n        }\n    }\n\n    drawAgent(ctx: CanvasRenderingContext2D, x: number, y: number) {\n        for (const agent of this.agents) {\n            if (agent.x == x && agent.y == y) {\n                agent.draw(ctx, this.t);\n            }\n        }\n    }\n}\n\nabstract class Element {\n    abstract collision: boolean;\n    abstract reward: number;\n    abstract reset: boolean;\n\n    draw(ctx: CanvasRenderingContext2D, x: number, y: number, t: number) {}\n}\n\nexport class Reward extends Element {\n    collision = false;\n    reward = 1;\n    reset = true;\n\n    draw(ctx: CanvasRenderingContext2D, x: number, y: number, t: number) {\n        ctx.drawImage(sprites.block, blockSize * x, blockSize * (y - 1.6));\n        ctx.drawImage(sprites.blockShadow, blockSize * x, blockSize * y);\n    }\n}\n\nexport class SmallReward extends Element {\n    collision = false;\n    reward = 0.5;\n    reset = true;\n\n    draw(ctx: CanvasRenderingContext2D, x: number, y: number, t: number) {\n        ctx.drawImage(sprites.redBlock, blockSize * x, blockSize * (y - 1.6));\n        ctx.drawImage(sprites.blockShadow, blockSize * x, blockSize * y);\n    }\n}\n\nexport class Monster extends Element {\n    collision = false;\n    reward = -1;\n    reset = true;\n\n    draw(ctx: CanvasRenderingContext2D, x: number, y: number, t: number) {\n        switch (t % 4) {\n            case 0:\n                ctx.drawImage(sprites.goomba, blockSize * x, blockSize * y);\n                break;\n            case 1:\n                ctx.drawImage(sprites.goomba2, blockSize * x, blockSize * y);\n                break;\n            case 2:\n                ctx.drawImage(sprites.goomba, blockSize * x, blockSize * y);\n                break;\n            case 3:\n                ctx.drawImage(sprites.goomba3, blockSize * x, blockSize * y);\n                break;\n        }\n    }\n}\n\n// Initialize the map and Q values\nexport function initSarsa(h: number, w: number) {\n    const map = new Map(h, w);\n    return map;\n}\n"],"sourceRoot":""}